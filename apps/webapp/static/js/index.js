"use strict";(()=>{var se=Object.defineProperty,ie=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var B=(e,t,r)=>t in e?se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,w=(e,t)=>{for(var r in t||(t={}))le.call(t,r)&&B(e,r,t[r]);if(I)for(var r of I(t))me.call(t,r)&&B(e,r,t[r]);return e},O=(e,t)=>ie(e,ce(t));var U={eng:"en",en:"en",ru:"ru",ua:"uk",uk:"uk"};function ue(e){var o;if(!e)return"en";let t=e.toLowerCase(),r=U[t];if(r)return r;let[n]=t.split("-");return(o=U[n])!=null?o:"en"}var _={history:"History",created:"Created",ai_label:"AI",service_unavailable:"Service temporarily unavailable",unauthorized:"Unauthorized",not_found:"Not found",server_error:"Server error",unexpected_error:"Unexpected error",no_programs:"No programs found",sort_newest:"Sort: Newest",sort_oldest:"Sort: Oldest",show_ai:"Show AI workout plans",back:"Back",open_from_telegram:"Open this page from Telegram.","program.title":"Workout Program","program.created":"Created: {date}","program.view_history":"View History","program.week":"Week {n}","program.day":"Day {n} \u2014 {title}","program.day.rest":"Rest Day",retry:"Retry","page.program":"Program","page.history":"History"},R={};async function de(e){let t=window.__STATIC_PREFIX__||"/static/";try{let r=await fetch(`${t}i18n/${e}.json`,{cache:"no-store"});R=r.ok?await r.json():w({},_)}catch(r){R=w({},_)}}function pe(e,t){return t?e.replace(/\{(\w+)\}/g,(r,n)=>{let o=t[n];return o==null?"":String(o)}):e}function d(e,t){var n;let r=(n=R[e])!=null?n:_[e];return pe(r,t)}async function h(e){var n,o,a;let t=e;try{let s=(n=window.Telegram)==null?void 0:n.WebApp;!t&&((a=(o=s==null?void 0:s.initDataUnsafe)==null?void 0:o.user)!=null&&a.language_code)&&(t=s.initDataUnsafe.user.language_code)}catch(s){}let r=ue(t);return document.documentElement.lang=r,await de(r),r}var W=[];function ge(e){let t=new URL(e.href);return(t.searchParams.get("type")||"program").toLowerCase()==="history"?{kind:"history"}:{kind:"program",source:t.searchParams.get("source")||"direct"}}function $(){let e=new URL(location.href);e.searchParams.set("type","history"),history.pushState({},"",e.toString()),T()}function P(e="direct"){let t=new URL(location.href);t.searchParams.set("type","program"),t.searchParams.set("source",e),history.pushState({},"",t.toString()),T()}function T(){let e=ge(location);W.forEach(t=>t(e))}function z(){T()}function F(e){W.push(e)}window.addEventListener("popstate",()=>T());var fe=["en","ru","uk"],G={ua:"uk"};function K(e,t){if(!e)return t;let r=e.toLowerCase();return r in G?G[r]:fe.includes(r)?r:t}var b=class extends Error{constructor(t,r){super(r),this.status=t}};function ye(e){switch(e){case 401:case 403:return"unauthorized";case 404:return"not_found";case 500:return"server_error";default:return"unexpected_error"}}async function he(e,t={}){let r=await fetch(e,t);if(!r.ok)throw new b(r.status,ye(r.status));return await r.json()}function Le(e){return typeof e=="object"&&e!==null&&"days"in e}async function V(e,t,r){var p,C,L,M,S,A;let n="en",o;if(typeof t=="string")n=t,o=r;else{try{let f=(p=window.Telegram)==null?void 0:p.WebApp,E=(L=(C=f==null?void 0:f.initDataUnsafe)==null?void 0:C.user)==null?void 0:L.language_code;E&&["en","ru","uk"].includes(E)&&(n=E)}catch(f){}o=t}let a=new URLSearchParams({locale:n,source:o.source});e&&a.set("program_id",e);let s=new URL("api/program/",window.location.href);a.forEach((f,E)=>{s.searchParams.set(E,f)});let l={};o.initData&&(l["X-Telegram-InitData"]=o.initData);let i=await he(s.toString(),{headers:l,signal:o.signal}),c=i.language,u=K(c!=null?c:i.locale,n);if(Le(i)){let f=K(i.locale,u);return{kind:"structured",program:O(w({},i),{locale:f,created_at:(M=i.created_at)!=null?M:null,weeks:(S=i.weeks)!=null?S:[],days:(A=i.days)!=null?A:[]}),locale:f}}let m=i.created_at,g=null;return typeof m=="number"?g=new Date(m*1e3).toISOString():typeof m=="string"&&(g=m),{kind:"legacy",programText:i.program,locale:u,createdAt:g}}function H(e,t){let r=typeof e=="number"?new Date(e*1e3):new Date(e);return Number.isNaN(r.getTime())?String(e):new Intl.DateTimeFormat(t,{day:"numeric",month:"short",year:"numeric"}).format(r)}function Ee(e){return e.weeks&&e.weeks.length>0?e.weeks:[{index:1,days:e.days}]}function we(e){let t=e.trim(),r=t.replace(/^(?:\d+[.)]\s+|\d+\s*[–—-]\s+|[-–—•*+]\s+)/,""),n=r.length>0?r:t,o=j(n);if(o.extraDetails.length>0)return{name:o.title,details:o.extraDetails.join(", ")};let a=[{pattern:/:/,offset:1},{pattern:/\s[–—-]\s/,offset:3}];for(let{pattern:s,offset:l}of a){let i=n.match(s);if(!i||i.index===void 0)continue;let c=i.index,u=n.slice(0,c).trim(),m=n.slice(c+l).trim();if(u.length>0&&m.length>0)return{name:u,details:m}}return{name:o.title,details:null}}var be=/^\s*\d+(?:\.\d+)*\s*[).:\-–—]?\s*/,xe=/\bset\s+\d+\b/i,Ce=/\bset\s+\d+\b/gi;function D(e){return e.replace(Ce," ").replace(/\s{2,}/g," ").trim()}function N(e){let t=e.trim();return t.length===0?!0:xe.test(t)?t.replace(/\bset\s+\d+\b/gi,"").trim().length===0:!1}function j(e){var c;let t=D(e.trim());if(t.length===0)return{title:"",extraDetails:[]};let n=t.replace(/\s[–—-]\s/g," | ").replace(/\s*[:：]\s*/g," | ").replace(/[|¦│]/g,"|").split("|").map(u=>D(u)).filter(u=>u.length>0),o=(c=n.shift())!=null?c:t,a=o.replace(be,"").trim(),s=a.length>0?a:o,l=n.filter(u=>!N(u)),i=Array.from(new Set(l));return{title:s,extraDetails:i}}function Pe(e){if(!e)return null;let t=D(e);return t.length===0||N(t)?null:t}function Te(e,t){let r=document.createElement("li");r.className="program-exercise";let n=document.createElement("details");n.className="program-exercise-details";let o=document.createElement("summary");o.className="program-exercise-summary";let a=j(e.name),s=a.title.length>0?a.title:e.name,l=document.createElement("span");l.className="program-exercise-index",l.textContent=String(t+1);let i=document.createElement("span");i.className="program-exercise-title",i.textContent=s,o.appendChild(l),o.appendChild(i),n.appendChild(o);let c=[...a.extraDetails];e.sets!==null&&e.sets!==void 0&&e.sets!==""&&c.push(`Sets: ${String(e.sets)}`),e.reps!==null&&e.reps!==void 0&&e.reps!==""&&c.push(`Reps: ${String(e.reps)}`),e.weight&&c.push(`Weight: ${e.weight.value} ${e.weight.unit}`),e.equipment&&c.push(`Equipment: ${e.equipment}`);let u=document.createElement("div");u.className="program-exercise-content";let m=Pe(e.notes),g=c.filter(p=>!N(p));if(g.length>0){let p=document.createElement("div");p.className="program-exercise-meta",p.textContent=g.join(", "),u.appendChild(p)}if(m){let p=document.createElement("p");p.className="program-exercise-notes",p.textContent=m,u.appendChild(p)}return u.childElementCount>0?(n.appendChild(u),r.appendChild(n),r):(n.classList.add("program-exercise-details-static"),o.classList.add("program-exercise-summary-static"),r.appendChild(n),r)}function q(e){var n;let t=document.createElement("details");t.className="program-day";let r=document.createElement("summary");if(r.className="program-day-summary",e.type==="rest")r.textContent=d("program.day.rest"),t.classList.add("program-day-rest");else{let o=(n=e.title)==null?void 0:n.trim();if(o&&o.length>0)r.textContent=o;else{let a=d("program.day",{n:e.index,title:""}).replace(/([\s—–-])+$/,"");r.textContent=a}}if(t.appendChild(r),e.type==="workout"&&e.exercises){let o=document.createElement("ul");o.className="program-day-list",e.exercises.forEach((a,s)=>{o.appendChild(Te(a,s))}),t.appendChild(o)}return t}function X(e){let t=document.createDocumentFragment();return Ee(e).forEach(n=>{let o=document.createElement("section");o.className="week";let a=document.createElement("h2");a.textContent=d("program.week",{n:n.index}),o.appendChild(a),n.days.forEach(s=>{o.appendChild(q(s))}),t.appendChild(o)}),{fragment:t}}function J(e,t){let r=document.createDocumentFragment();return e.split(/\n\s*\n/).filter(o=>o.trim().length>0).forEach((o,a)=>{let s=o.split(/\n/).map(c=>c.trim()).filter(Boolean);if(s.length===0)return;let l=s.slice(1).map((c,u)=>{let m=we(c);return{id:`ex-${a+1}-${u+1}`,name:m.name,sets:null,reps:null,weight:null,equipment:null,notes:m.details}}),i={id:`legacy-${a+1}`,index:a+1,type:"workout",title:s[0],exercises:l};r.appendChild(q(i))}),{fragment:r}}function x(){var e,t;try{return(t=(e=window.Telegram)==null?void 0:e.WebApp)!=null?t:null}catch(r){return null}}function Y(){var e,t;try{(t=(e=x())==null?void 0:e.ready)==null||t.call(e)}catch(r){}}function Z(){var e,t;try{(t=(e=x())==null?void 0:e.expand)==null||t.call(e)}catch(r){}}var ke=/^#?(?:[0-9a-f]{3}|[0-9a-f]{6}|[0-9a-f]{8})$/i;function Q(e){if(!e)return null;let t=e.trim();return t.length===0||!ke.test(t)?null:t.startsWith("#")?t:`#${t}`}function ee(){var o,a,s,l;let e=x();if(!e)return;let t=Q((o=e.themeParams)==null?void 0:o.bg_color),r=Q((a=e.themeParams)==null?void 0:a.secondary_bg_color),n=t!=null?t:r;if(n){try{(s=e.setBackgroundColor)==null||s.call(e,n)}catch(i){}try{(l=e.setHeaderColor)==null||l.call(e,"secondary_bg_color")}catch(i){}try{t&&document.documentElement.style.setProperty("--tg-theme-bg-color",t),r?document.documentElement.style.setProperty("--tg-theme-secondary-bg-color",r):t&&document.documentElement.style.setProperty("--tg-theme-secondary-bg-color",t),document.documentElement.style.backgroundColor=n,document.body.style.backgroundColor=n}catch(i){}}}function k(){var e,t;return(t=(e=x())==null?void 0:e.initData)!=null?t:""}var v={en:"en",ru:"ru",uk:"uk"};function _e(e){var n;if(!e)return null;let t=e.toLowerCase();if(t in v)return v[t];let[r]=t.split("-");return(n=v[r])!=null?n:null}function te(e="en"){var r,n,o,a;let t=(o=(n=(r=x())==null?void 0:r.initDataUnsafe)==null?void 0:n.user)==null?void 0:o.language_code;return(a=_e(t))!=null?a:e}function re(e,t){t?e.setAttribute("aria-busy","true"):e.removeAttribute("aria-busy")}function Re(){return new URL(location.href).searchParams.get("id")}function De(e,t){let r=e;if(r instanceof HTMLButtonElement){let o=document.createElement("span");for(o.id=r.id,o.className=r.className;r.firstChild;)o.appendChild(r.firstChild);r.replaceWith(o),r=o}r.classList.remove("chip","badge","pill","tag");let n=r.closest(".chip, .badge, .pill, .tag, button");return n&&n!==r&&t.contains(n)&&(n.classList.remove("chip","badge","pill","tag"),n.style.border="none",n.style.borderRadius="0",n.style.boxShadow="none",n.style.background="transparent",n.style.padding="0",n.contains(r)&&n.replaceWith(r)),r.setAttribute("role","text"),r.style.border="none",r.style.borderRadius="0",r.style.boxShadow="none",r.style.background="transparent",r.style.padding="0",r}async function ne(e,t){let{root:r,content:n,titleEl:o}=e,{dateEl:a}=e,s=k(),l=new AbortController;o&&(o.textContent=d("page.program")),re(n,!0),a=De(a,r),a.hidden=!1,a.textContent="";try{let i=Re(),c=await V(i!=null?i:"",{initData:s,source:t,signal:l.signal}),u=await h(c.locale);o&&(o.textContent=d("page.program"));let m=u;if(n.innerHTML="",c.kind==="structured"){c.program.created_at&&(a.textContent=d("program.created",{date:H(c.program.created_at,m)}));let g=X(c.program);n.appendChild(g.fragment)}else{c.createdAt&&(a.textContent=d("program.created",{date:H(c.createdAt,m)}));let g=J(c.programText,m);n.appendChild(g.fragment)}Y()}catch(i){let c="unexpected_error";i instanceof b&&(c=i.message),n.innerHTML=`<div class="notice">${d(c)}</div>`}finally{re(n,!1)}return()=>{l.abort()}}var y=document.getElementById("content"),oe=document.getElementById("program-date");async function He(e){let t={},r=k();r&&(t["X-Telegram-InitData"]=r);let n=new URL("api/programs/",window.location.href);n.searchParams.set("locale",e);let o=await fetch(n.toString(),{headers:t});if(!o.ok)throw new Error("unexpected_error");return await o.json()}async function ae(e){var o,a;if(!y)return;y.setAttribute("aria-busy","true"),y.innerHTML="",oe&&(oe.hidden=!0),e&&(e.textContent=d("page.history"));let t=document.createElement("div");t.className="week";let r=document.createElement("h2");r.textContent=d("history"),t.appendChild(r);let n=document.createElement("ul");n.className="history-list",t.appendChild(n),y.appendChild(t);try{let s=te(),l=await He(s),i=await h((o=l.language)!=null?o:s);e&&(e.textContent=d("page.history"));let c=()=>new URL(window.location.href).searchParams.get("source")==="subscription"?"subscription":"direct";r.textContent=d("history");let u=(a=l.programs)!=null?a:[];if(u.length===0){let m=document.createElement("p");m.className="history-empty",m.textContent=d("no_programs"),y.appendChild(m)}else u.forEach(m=>{let g=document.createElement("li"),p=document.createElement("a");p.href="#",p.textContent=new Date(m.created_at*1e3).toLocaleString(i),p.onclick=C=>{C.preventDefault();let L=new URL(window.location.href);L.searchParams.set("id",String(m.id)),history.replaceState({},"",L.toString()),P("direct")},g.appendChild(p),n.appendChild(g)})}catch(s){let l=document.createElement("div");l.className="error-block",l.textContent=d("unexpected_error"),y.appendChild(l)}finally{y.removeAttribute("aria-busy")}}function Ne(){let e=document.getElementById("controls");if(!e)return null;e.innerHTML="";let t=document.createElement("div");t.className="history-footer";let r=document.createElement("button");return r.type="button",r.id="history-button",r.className="primary-button",r.disabled=!0,t.appendChild(r),e.appendChild(t),r}function ve(){try{return(new URL(window.location.href).searchParams.get("source")||"").toLowerCase()==="subscription"?"subscription":"direct"}catch(e){return"direct"}}async function Me(e,t,r){let{historyButton:n,titleEl:o}=t;if(r.current)try{r.current()}catch(s){}if(r.current=void 0,e.kind==="history"){let s=ve();n&&(n.disabled=!0),await ae(o!=null?o:void 0),n&&(n.textContent=d("back"),n.disabled=!1,n.onclick=()=>P(s));return}n&&(n.disabled=!0);let a=await ne({root:t.root,content:t.content,dateEl:t.dateEl,button:n,titleEl:o},e.source);r.current=a,n&&(n.textContent=d("program.view_history"),n.disabled=!1,n.onclick=()=>$())}async function Se(){let e=document.getElementById("app"),t=document.getElementById("content"),r=document.getElementById("program-date"),n=document.getElementById("page-title");if(!e||!t||!r)return;try{await h()}catch(s){}Z(),ee();let o=Ne(),a={};F(s=>{Me(s,{root:e,content:t,dateEl:r,historyButton:o,titleEl:n},a)}),z()}Se();})();
//# sourceMappingURL=index.js.map
